#!/bin/bash

# ▗▖  ▗▖ ▗▄▖ ▗▄▄▄  ▗▄▄▄▖    ▗▖  ▗▖▗▄▄▄▖▗▖  ▗▖▗▄▄▄▖▗▖  ▗▖▗▄▄▄▖▗▄▄▄▄▖▗▄▄▄▖▗▄▄▖
# ▐▛▚▖▐▌▐▌ ▐▌▐▌  █ ▐▌       ▐▛▚▞▜▌  █  ▐▛▚▖▐▌  █  ▐▛▚▞▜▌  █     ▗▞▘▐▌   ▐▌ ▐▌
# ▐▌ ▝▜▌▐▌ ▐▌▐▌  █ ▐▛▀▀▘    ▐▌  ▐▌  █  ▐▌ ▝▜▌  █  ▐▌  ▐▌  █   ▗▞▘  ▐▛▀▀▘▐▛▀▚▖
# ▐▌  ▐▌▝▚▄▞▘▐▙▄▄▀ ▐▙▄▄▖    ▐▌  ▐▌▗▄█▄▖▐▌  ▐▌▗▄█▄▖▐▌  ▐▌▗▄█▄▖▐▙▄▄▄▖▐▙▄▄▖▐▌ ▐▌
#
# AUTHOR: MHD

# Get current window address (window under cursor)
current_window=$(hyprctl activewindow -j | jq -r '.address')

# Check if there's already a minimized window
minimized_window=$(hyprctl clients -j | jq -r '.[] | select(.workspace.name == "special:minimized") | .address' | head -n1)

if [ -n "$minimized_window" ] && [ "$minimized_window" != "null" ]; then
    # There's already a minimized window, restore it first
    current_workspace=$(hyprctl activeworkspace -j | jq -r '.id')
    hyprctl dispatch movetoworkspace "$current_workspace",address:"$minimized_window"
    hyprctl dispatch focuswindow address:"$minimized_window"
else
    # No minimized window exists, minimize the current one
    if [ "$current_window" != "null" ] && [ -n "$current_window" ]; then
        hyprctl dispatch movetoworkspacesilent special:minimized,address:"$current_window"
    fi
fi
